# ローカルデモ用 Dockerfile（Docker / compose local）
# - API: src/services/api/main.py (FastAPI)
# - 起動: uvicorn services.api.main:app
#
# NOTE:
#   - demo.local.with-tests.ps1 で同じ Dockerfile を使って pytest を実行するため、
#     pytest / httpx などテスト依存も含めています。

FROM python:3.11-slim

WORKDIR /app

# 依存関係（ローカルデモ + テストに必要な最小）
RUN pip install --no-cache-dir \
  fastapi==0.* \
  "uvicorn[standard]==0.*" \
  pydantic==2.* \
  jsonschema==4.* \
  requests==2.* \
  httpx==0.* \
  pytest==8.*

# ソースをコピー
COPY . /app

# src 配下（services.*）を import できるようにする
ENV PYTHONPATH=/app/src

EXPOSE 8080

# ローカルデモは --reload を使う（compose側で上書き可能）
CMD ["uvicorn", "services.api.main:app", "--host", "0.0.0.0", "--port", "8080", "--reload"]
