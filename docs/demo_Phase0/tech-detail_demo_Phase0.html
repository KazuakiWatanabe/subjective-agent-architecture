<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subjective Agent Architecture â€“ Tech Detail</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', 'Helvetica Neue', sans-serif; background: #0d1117; color: #e6edf3; line-height: 1.7; }
  .page { max-width: 960px; margin: 0 auto; padding: 40px 24px; }

  /* Hero */
  .hero { text-align: center; padding: 60px 0 40px; border-bottom: 1px solid #30363d; margin-bottom: 48px; }
  .hero h1 { font-size: 2rem; color: #58a6ff; letter-spacing: 0.04em; }
  .hero .sub { color: #8b949e; margin-top: 8px; font-size: 0.95rem; }
  .badge { display: inline-block; margin: 4px; padding: 3px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
  .b-blue { background: #1f4068; color: #58a6ff; }
  .b-green { background: #0d3a1f; color: #3fb950; }
  .b-yellow { background: #3a2d00; color: #d29922; }

  /* Section */
  .section { margin-bottom: 56px; }
  .section h2 { font-size: 1.2rem; color: #58a6ff; border-left: 4px solid #58a6ff; padding-left: 12px; margin-bottom: 20px; }

  /* Pipeline */
  .pipeline { display: flex; align-items: center; flex-wrap: wrap; gap: 0; margin: 16px 0; }
  .pipe-step { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 12px 16px; text-align: center; min-width: 120px; flex: 1; }
  .pipe-step .name { font-size: 0.85rem; font-weight: 700; color: #58a6ff; }
  .pipe-step .desc { font-size: 0.72rem; color: #8b949e; margin-top: 4px; }
  .pipe-arrow { color: #30363d; font-size: 1.4rem; padding: 0 4px; }

  /* Code block */
  pre { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 20px; overflow-x: auto; font-size: 0.82rem; line-height: 1.6; }
  .kw { color: #ff7b72; }
  .str { color: #a5d6ff; }
  .key { color: #79c0ff; }
  .val { color: #a8ff78; }
  .cmt { color: #8b949e; font-style: italic; }

  /* Table */
  table { width: 100%; border-collapse: collapse; font-size: 0.88rem; }
  th { background: #161b22; color: #8b949e; font-weight: 600; padding: 10px 14px; text-align: left; border-bottom: 1px solid #30363d; }
  td { padding: 10px 14px; border-bottom: 1px solid #21262d; vertical-align: top; }
  td.ok { color: #3fb950; }
  td.wip { color: #d29922; }
  td.next { color: #8b949e; }

  /* Cards */
  .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
  .card { background: #161b22; border: 1px solid #30363d; border-radius: 10px; padding: 18px 20px; }
  .card h3 { font-size: 0.9rem; color: #58a6ff; margin-bottom: 8px; }
  .card p, .card li { font-size: 0.83rem; color: #8b949e; }
  .card ul { padding-left: 16px; }
  .card li { margin-bottom: 4px; }

  /* Flow diagram */
  .flow { background: #161b22; border: 1px solid #30363d; border-radius: 10px; padding: 24px; font-size: 0.83rem; }
  .flow-row { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 14px; }
  .flow-tag { min-width: 120px; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-align: center; }
  .t-reader { background: #1f4068; color: #58a6ff; }
  .t-validator { background: #0d3a1f; color: #3fb950; }
  .t-generator { background: #3a1a5c; color: #bc8cff; }
  .t-action { background: #3a2d00; color: #d29922; }
  .flow-detail { color: #c9d1d9; }
  .flow-detail small { color: #8b949e; display: block; }

  /* Roadmap */
  .roadmap { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
  .rm-phase { background: #161b22; border: 1px solid #30363d; border-radius: 10px; padding: 18px; }
  .rm-phase h3 { font-size: 0.85rem; font-weight: 700; margin-bottom: 10px; }
  .rm-phase ul { list-style: none; padding: 0; }
  .rm-phase li { font-size: 0.8rem; color: #8b949e; padding: 3px 0; }
  .rm-phase li::before { content: 'â†’ '; color: #58a6ff; }
  .ph1 h3 { color: #3fb950; }
  .ph2 h3 { color: #58a6ff; }
  .ph3 h3 { color: #bc8cff; }

  footer { text-align: center; padding: 32px 0; color: #30363d; font-size: 0.78rem; border-top: 1px solid #21262d; margin-top: 48px; }

  @media (max-width: 600px) {
    .pipeline { flex-direction: column; }
    .pipe-arrow { transform: rotate(90deg); }
    .roadmap { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<div class="page">

  <!-- Hero -->
  <div class="hero">
    <h1>Subjective Agent Architecture</h1>
    <div class="sub">æŠ€è¡“è€…å‘ã‘è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ â€” Internal Review</div>
    <div style="margin-top:14px;">
      <span class="badge b-green">Docker âœ“</span>
      <span class="badge b-green">pytest 37ä»¶ PASS âœ“</span>
      <span class="badge b-blue">dry_run mode</span>
      <span class="badge b-yellow">Phase 0 å®Œäº†</span>
    </div>
  </div>

  <!-- 1. è¨­è¨ˆæ€æƒ³ -->
  <div class="section">
    <h2>1. è¨­è¨ˆæ€æƒ³ â€” ãªãœã€Œstateåˆ†å‰²ã€ã‹</h2>
    <div class="cards">
      <div class="card">
        <h3>âŒ è‡ªç„¶æ–‡ã®ã¾ã¾æ¸¡ã™ã¨</h3>
        <ul>
          <li>æ–½ç­–ã«æ¥ç¶šã§ããªã„</li>
          <li>APIã«æ¸¡ã›ãªã„</li>
          <li>ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ä¸èƒ½</li>
          <li>ç›£æŸ»ãƒ­ã‚°ãŒæ®‹ã‚‰ãªã„</li>
        </ul>
      </div>
      <div class="card">
        <h3>âœ… stateåŒ–ã™ã‚‹ã“ã¨ã§</h3>
        <ul>
          <li>JSONæ§‹é€ ã¨ã—ã¦å›ºå®šåŒ–</li>
          <li>ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼å¯èƒ½</li>
          <li>DBä¿å­˜ãƒ»ç›£æŸ»å¯èƒ½</li>
          <li>APIå¼•æ•°ã¨ã—ã¦åˆ©ç”¨å¯èƒ½</li>
        </ul>
      </div>
      <div class="card">
        <h3>ğŸ”’ å®‰å…¨è¨­è¨ˆã®å‰æ</h3>
        <ul>
          <li>å…¨actionã¯dry_runãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</li>
          <li>rollback_planãŒå¸¸ã«å­˜åœ¨</li>
          <li>trace_idã§èª¬æ˜è²¬ä»»ã‚’æ‹…ä¿</li>
          <li>retry / fallbackãƒ­ã‚¸ãƒƒã‚¯å†…è”µ</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- 2. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ -->
  <div class="section">
    <h2>2. å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æˆ</h2>
    <div class="pipeline">
      <div class="pipe-step">
        <div class="name">è‡ªç„¶æ–‡å…¥åŠ›</div>
        <div class="desc">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè©± / CSè¨˜éŒ²</div>
      </div>
      <div class="pipe-arrow">â†’</div>
      <div class="pipe-step">
        <div class="name">Reader</div>
        <div class="desc">stateæŠ½å‡º</div>
      </div>
      <div class="pipe-arrow">â†’</div>
      <div class="pipe-step">
        <div class="name">Validator</div>
        <div class="desc">å¿…é ˆé …ç›® / æ•´åˆãƒã‚§ãƒƒã‚¯</div>
      </div>
      <div class="pipe-arrow">â†’</div>
      <div class="pipe-step">
        <div class="name">Generator</div>
        <div class="desc">JSONå›ºå®šæ§‹é€ å‡ºåŠ›</div>
      </div>
      <div class="pipe-arrow">â†’</div>
      <div class="pipe-step">
        <div class="name">Action Binder</div>
        <div class="desc">æ¥­å‹™APIæ¥ç¶š (dry_run)</div>
      </div>
    </div>

    <div class="flow" style="margin-top:20px;">
      <div class="flow-row">
        <span class="flow-tag t-reader">Reader</span>
        <div class="flow-detail">
          è‡ªç„¶æ–‡ã‹ã‚‰stateé…åˆ—ã‚’æŠ½å‡ºã€‚LLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æ§‹é€ åŒ–ã€‚
          <small>å‡ºåŠ›ä¾‹: ["æ¥åº—é »åº¦ä½ä¸‹", "ä¾¡æ ¼æ„Ÿåº¦ä½", "é™å®šæ„Ÿå¿—å‘"]</small>
        </div>
      </div>
      <div class="flow-row">
        <span class="flow-tag t-validator">Validator</span>
        <div class="flow-detail">
          state / intent / next_actionsã®å­˜åœ¨ç¢ºèªãƒ»å‹ãƒã‚§ãƒƒã‚¯ã€‚å¤±æ•—æ™‚ã¯retry â†’ fallbackã€‚
          <small>JSONã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ + ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«é©ç”¨</small>
        </div>
      </div>
      <div class="flow-row">
        <span class="flow-tag t-generator">Generator</span>
        <div class="flow-detail">
          å›ºå®šã‚¹ã‚­ãƒ¼ãƒã§JSONå‡ºåŠ›ã€‚rollback_plan / trace_id ã‚’è‡ªå‹•ä»˜ä¸ã€‚
          <small>å‡ºåŠ›ã¯æ¯å›ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ã—ã€10å›å®‰å®šå‡ºåŠ›ã‚’ç¢ºèªæ¸ˆã¿</small>
        </div>
      </div>
      <div class="flow-row">
        <span class="flow-tag t-action">Action Binder</span>
        <div class="flow-detail">
          action_bindingsã«å¾“ã„APIã‚’å‘¼ã³å‡ºã—ã€‚ç¾åœ¨ã¯ã™ã¹ã¦dry_run=trueã€‚
          <small>{"api": "line.broadcast", "dry_run": true}</small>
        </div>
      </div>
    </div>
  </div>

  <!-- 3. å‡ºåŠ›ã‚¹ã‚­ãƒ¼ãƒ -->
  <div class="section">
    <h2>3. å‡ºåŠ›ã‚¹ã‚­ãƒ¼ãƒï¼ˆå›ºå®šæ§‹é€ ï¼‰</h2>
    <pre><span class="cmt">// ã‚·ãƒŠãƒªã‚ªA: ãƒãƒ£ãƒ¼ãƒ³å‚¾å‘ã®å…¥åŠ›</span>
<span class="cmt">// å…¥åŠ›: ã€Œæœ€è¿‘æ¥åº—ãŒæ¸›ã£ã¦ã„ã‚‹ã€‚å€¤å¼•ãã«ã¯åå¿œã—ãªã„ãŒã€é™å®šæ„Ÿã«ã¯åå¿œã™ã‚‹ã€‚ã€</span>

{
  <span class="key">"trace_id"</span>: <span class="str">"agt-20240601-0042"</span>,
  <span class="key">"state"</span>: [
    <span class="str">"æ¥åº—é »åº¦ä½ä¸‹"</span>,
    <span class="str">"ä¾¡æ ¼æ„Ÿåº¦ä½"</span>,
    <span class="str">"é™å®šæ„Ÿå¿—å‘"</span>
  ],
  <span class="key">"intent"</span>: <span class="str">"å†æ¥åº—å‹•æ©Ÿä»˜ã‘"</span>,
  <span class="key">"next_actions"</span>: [
    <span class="str">"é™å®šLINEé…ä¿¡æ¡ˆ"</span>,
    <span class="str">"ä¼šå“¡é™å®šã‚¤ãƒ™ãƒ³ãƒˆ"</span>
  ],
  <span class="key">"rollback_plan"</span>: <span class="str">"é…ä¿¡åœæ­¢ â†’ é€šå¸¸æ–½ç­–ã«æˆ»ã™"</span>,
  <span class="key">"action_bindings"</span>: [
    {
      <span class="key">"api"</span>: <span class="str">"line.broadcast"</span>,
      <span class="key">"dry_run"</span>: <span class="kw">true</span>   <span class="cmt">// ç¾ãƒ•ã‚§ãƒ¼ã‚ºã¯å…¨ã¦dry_run</span>
    }
  ]
}</pre>
  </div>

  <!-- 4. ãƒ†ã‚¹ãƒˆè¨­è¨ˆ -->
  <div class="section">
    <h2>4. ãƒ†ã‚¹ãƒˆè¨­è¨ˆ â€” pytest 37ä»¶æ§‹æˆ</h2>
    <table>
      <tr>
        <th>ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª</th>
        <th>å†…å®¹</th>
        <th>ä»¶æ•°</th>
        <th>çŠ¶æ…‹</th>
      </tr>
      <tr>
        <td>ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼</td>
        <td>å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ»å‹ãƒ»æ§‹é€ ã®æ­£å½“æ€§</td>
        <td>8</td>
        <td class="ok">âœ… PASS</td>
      </tr>
      <tr>
        <td>Retryãƒ­ã‚¸ãƒƒã‚¯</td>
        <td>Validatorå¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤ / fallbackå‹•ä½œ</td>
        <td>6</td>
        <td class="ok">âœ… PASS</td>
      </tr>
      <tr>
        <td>dry_runæ¤œè¨¼</td>
        <td>action_bindingsãŒdry_run=trueã‚’ç¶­æŒã—ã¦ã„ã‚‹ã‹</td>
        <td>5</td>
        <td class="ok">âœ… PASS</td>
      </tr>
      <tr>
        <td>å®‰å®šå‡ºåŠ›æ¤œè¨¼</td>
        <td>åŒä¸€å…¥åŠ›ã§10å›é€£ç¶šå‡ºåŠ›ãŒæ§‹é€ çš„ã«ä¸€è‡´ã™ã‚‹ã‹</td>
        <td>10</td>
        <td class="ok">âœ… PASS</td>
      </tr>
      <tr>
        <td>E2Eã‚·ãƒŠãƒªã‚ª</td>
        <td>ã‚·ãƒŠãƒªã‚ªA/B/C ã®å…¥åŠ›â†’å‡ºåŠ›ã®å®Œå…¨ãƒ•ãƒ­ãƒ¼</td>
        <td>8</td>
        <td class="ok">âœ… PASS</td>
      </tr>
    </table>

    <pre style="margin-top:16px;"><span class="cmt"># å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ (PowerShell)</span>
<span class="val">cd</span> C:\Git\subjective-agent-architecture\script
<span class="val">Set-ExecutionPolicy</span> -Scope Process -ExecutionPolicy Bypass
.\demo.local.with-tests.ps1

<span class="cmt"># ãƒ­ã‚°ä¿å­˜å…ˆ</span>
test/evidence/pytest.local.<span class="str">YYYYMMDD-HHMMSS</span>.log</pre>
  </div>

  <!-- 5. æ¥­å‹™ã‚·ãƒŠãƒªã‚ª -->
  <div class="section">
    <h2>5. æ¥­å‹™æ¥ç¶šã‚·ãƒŠãƒªã‚ªå¯¾å¿œè¡¨</h2>
    <table>
      <tr>
        <th>ã‚·ãƒŠãƒªã‚ª</th>
        <th>å…¥åŠ›æ¦‚è¦</th>
        <th>æŠ½å‡ºstate</th>
        <th>intent</th>
        <th>æ¥ç¶šå…ˆAPI</th>
      </tr>
      <tr>
        <td><strong>A: ãƒãƒ£ãƒ¼ãƒ³å‚¾å‘</strong></td>
        <td>æ¥åº—æ¸›ãƒ»å€¤å¼•ãä¸åå¿œãƒ»é™å®šæ„Ÿåå¿œ</td>
        <td>æ¥åº—é »åº¦ä½ä¸‹ / ä¾¡æ ¼æ„Ÿåº¦ä½ / é™å®šæ„Ÿå¿—å‘</td>
        <td>å†æ¥åº—å‹•æ©Ÿä»˜ã‘</td>
        <td>line.broadcast (dry_run)</td>
      </tr>
      <tr>
        <td><strong>B: è²»ç”¨å¯¾åŠ¹æœ</strong></td>
        <td>æˆæœãŒè¦‹ãˆãªã„ã¨åº—èˆ—ã‹ã‚‰æŒ‡æ‘˜</td>
        <td>æˆæœä¸é€æ˜ / èª¬æ˜ä¸è¶³</td>
        <td>æˆæœå¯è¦–åŒ–</td>
        <td>dashboard.generate (dry_run)</td>
      </tr>
      <tr>
        <td><strong>C: ç¾å ´è² è·</strong></td>
        <td>é…ä¿¡ä½œæ¥­ãŒé¢å€’ã§ç¶™ç¶šä¸å¯</td>
        <td>é‹ç”¨è² è·é«˜</td>
        <td>ä½œæ¥­ç°¡ç•¥åŒ–</td>
        <td>template.generate (dry_run)</td>
      </tr>
    </table>
  </div>

  <!-- 6. åˆ°é”ç‚¹ã¨èª²é¡Œ -->
  <div class="section">
    <h2>6. ç¾ãƒ•ã‚§ãƒ¼ã‚ºã®åˆ°é”ç‚¹ã¨æœªè§£æ±ºäº‹é …</h2>
    <table>
      <tr><th>é …ç›®</th><th>çŠ¶æ…‹</th><th>è£œè¶³</th></tr>
      <tr><td>å†ç¾æ€§ï¼ˆDocker + pytestï¼‰</td><td class="ok">âœ… å®Œäº†</td><td>37ä»¶å…¨PASSãƒ»è¨¼è·¡ãƒ­ã‚°ã‚ã‚Š</td></tr>
      <tr><td>ã‚¹ã‚­ãƒ¼ãƒå›ºå®šåŒ–</td><td class="ok">âœ… å®Œäº†</td><td>10å›é€£ç¶šå®‰å®šå‡ºåŠ›ç¢ºèª</td></tr>
      <tr><td>dry_runå®‰å…¨è¨­è¨ˆ</td><td class="ok">âœ… å®Œäº†</td><td>å…¨actionã§dry_run=trueå¼·åˆ¶</td></tr>
      <tr><td>rollback_planä»˜ä¸</td><td class="ok">âœ… å®Œäº†</td><td>å‡ºåŠ›ã‚¹ã‚­ãƒ¼ãƒã«å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦å®šç¾©</td></tr>
      <tr><td>trace_idç®¡ç†</td><td class="ok">âœ… å®Œäº†</td><td>å…¨å‡ºåŠ›ã«è‡ªå‹•ä»˜ä¸</td></tr>
      <tr><td>æœ¬ç•ªAPIå®Ÿæ¥ç¶š</td><td class="wip">ğŸ”¶ æœªç€æ‰‹</td><td>LINE 1ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿæ–½</td></tr>
      <tr><td>BigQueryä¿å­˜</td><td class="next">â³ Phase 1</td><td>æˆæœãƒ­ã‚°å¯è¦–åŒ–ã¨åŒæ™‚å®Ÿè£…äºˆå®š</td></tr>
      <tr><td>ABææ¡ˆè‡ªå‹•åŒ–</td><td class="next">â³ Phase 2</td><td>ãƒãƒ£ãƒ¼ãƒ³ç‰¹åŒ–Agentã¨ã—ã¦è¨­è¨ˆäºˆå®š</td></tr>
    </table>
  </div>

  <!-- 7. ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— -->
  <div class="section">
    <h2>7. å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</h2>
    <div class="roadmap">
      <div class="rm-phase ph1">
        <h3>Phase 0 âœ… å®Œäº†</h3>
        <ul>
          <li>ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹é€ è¨­è¨ˆ</li>
          <li>Dockerç’°å¢ƒæ•´å‚™</li>
          <li>pytest 37ä»¶æ•´å‚™</li>
          <li>dry_runå®‰å…¨è¨­è¨ˆ</li>
          <li>ã‚¹ã‚­ãƒ¼ãƒå›ºå®šãƒ»å®‰å®šå‡ºåŠ›ç¢ºèª</li>
        </ul>
      </div>
      <div class="rm-phase ph2">
        <h3>Phase 1 ğŸ”¶ æ¬¡ãƒ•ã‚§ãƒ¼ã‚º</h3>
        <ul>
          <li>LINE broadcast å®Ÿæ¥ç¶šï¼ˆ1ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰</li>
          <li>BigQueryä¿å­˜è¨­è¨ˆ</li>
          <li>æˆæœãƒ­ã‚°å¯è¦–åŒ–</li>
          <li>dry_run â†’ æœ¬ç•ªåˆ‡æ›¿ãƒ•ãƒ©ã‚°è¨­è¨ˆ</li>
        </ul>
      </div>
      <div class="rm-phase ph3">
        <h3>Phase 2 â³ è¨ˆç”»ä¸­</h3>
        <ul>
          <li>ãƒãƒ£ãƒ¼ãƒ³å¯¾ç­–ç‰¹åŒ–Agent</li>
          <li>æ¥åº—é »åº¦ä½ä¸‹ã«ç‰¹åŒ–ã—ãŸè‡ªå‹•åˆ†å²</li>
          <li>æˆæœãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°çµ±åˆ</li>
          <li>ABææ¡ˆã®è‡ªå‹•ç”Ÿæˆ</li>
        </ul>
      </div>
    </div>
  </div>

  <footer>Subjective Agent Architecture â€” Internal Technical Document â€” Confidential</footer>
</div>
</body>
</html>
